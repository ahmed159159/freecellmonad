<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>FreeCell - نسخة ويب</title>
  <style>
    body {
      background-color: #064420;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 10px;
    }
    #controls {
      margin: 10px;
    }
    button {
      margin: 5px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      background-color: #1b4332;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #2d6a4f;
    }
    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    #top-row, #bottom-row {
      display: flex;
      justify-content: center;
      margin: 10px;
    }
    .pile {
      width: 80px;
      height: 120px;
      border: 1px dashed rgba(255,255,255,0.4);
      border-radius: 8px;
      margin: 5px;
      position: relative;
    }
    .card {
      width: 80px;
      height: 120px;
      border-radius: 8px;
      position: absolute;
      top: 0;
      left: 0;
      user-select: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>لعبة FreeCell</h1>
  <div id="controls">
    <button onclick="restartGame()">إعادة تشغيل</button>
    <button onclick="undoMove()">تراجع (Undo)</button>
    <button onclick="showHint()">تلميح (Hint)</button>
  </div>
  <div id="game">
    <div id="top-row">
      <div id="freecells" style="display:flex;"></div>
      <div id="foundations" style="display:flex; margin-left:50px;"></div>
    </div>
    <div id="bottom-row">
      <div id="tableau" style="display:flex;"></div>
    </div>
  </div>

  <script>
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    const suits = ["S","H","D","C"]; // Spades, Hearts, Diamonds, Clubs

    let gameState = { tableau: [], freecells: [], foundations: [], history: [] };

    function cardId(card) {
      return card.rank + card.suit;
    }

    function createCardImg(card) {
      const img = document.createElement('img');
      img.className = 'card';
      img.src = `Cards/${card.rank}${card.suit}.jpg`;
      img.dataset.id = cardId(card);
      img.draggable = false;
      return img;
    }

    function initDeck() {
      let deck = [];
      for (let r of ranks) {
        for (let s of suits) {
          deck.push({rank:r, suit:s});
        }
      }
      // Shuffle
      for (let i=deck.length-1;i>0;i--) {
        const j=Math.floor(Math.random()*(i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
      }
      return deck;
    }

    function restartGame(){
      const deck = initDeck();
      gameState.tableau = [[],[],[],[],[],[],[],[]];
      for (let i=0;i<deck.length;i++){
        gameState.tableau[i%8].push(deck[i]);
      }
      gameState.freecells = [null,null,null,null];
      gameState.foundations = [[],[],[],[]];
      gameState.history = [];
      render();
    }

    function undoMove(){
      if (gameState.history.length>0){
        gameState = gameState.history.pop();
        render();
      }
    }

    function showHint(){
      alert("التلميحات لم تُنفذ بعد 🙂");
    }

    function render(){
      const freeDiv = document.getElementById('freecells');
      const foundDiv = document.getElementById('foundations');
      const tabDiv = document.getElementById('tableau');
      freeDiv.innerHTML = "";
      foundDiv.innerHTML = "";
      tabDiv.innerHTML = "";

      // Freecells
      for (let i=0;i<4;i++){
        const slot=document.createElement('div');
        slot.className="pile";
        if (gameState.freecells[i]){
          const img=createCardImg(gameState.freecells[i]);
          slot.appendChild(img);
        }
        freeDiv.appendChild(slot);
      }

      // Foundations
      for (let i=0;i<4;i++){
        const slot=document.createElement('div');
        slot.className="pile";
        if (gameState.foundations[i].length>0){
          const top=gameState.foundations[i][gameState.foundations[i].length-1];
          const img=createCardImg(top);
          slot.appendChild(img);
        }
        foundDiv.appendChild(slot);
      }

      // Tableau
      for (let i=0;i<8;i++){
        const slot=document.createElement('div');
        slot.className="pile";
        gameState.tableau[i].forEach((card,idx)=>{
          const img=createCardImg(card);
          img.style.top = (idx*25)+"px";
          slot.appendChild(img);
        });
        tabDiv.appendChild(slot);
      }
    }

    restartGame();
  </script>
</body>
</html>
